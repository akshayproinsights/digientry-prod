2026-01-30 09:53:53 2026-01-30 09:53:53,063 - routes.stock_routes - INFO - Starting stock recalculation for Adnak
2026-01-30 09:53:53 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/stock/summary
2026-01-30 09:53:53 2026-01-30 09:53:53,156 - routes.stock_routes - INFO - Found 112 vendor invoice items
2026-01-30 09:53:53 2026-01-30 09:53:53,156 - routes.stock_routes - INFO - Fetching ALL sales records for Adnak with pagination...
2026-01-30 09:53:53 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/stock/levels?status_filter=all&priority_filter=all&_t=1769766826884
2026-01-30 09:53:53 2026-01-30 09:53:53,205 - routes.stock_routes - INFO - Found 211 sales invoice items
2026-01-30 09:53:53 2026-01-30 09:53:53,241 - routes.stock_routes - INFO - Retrieved 95 stock levels for Adnak
2026-01-30 09:53:53 2026-01-30 09:53:53,249 - routes.stock_routes - INFO - Found 6 inventory mappings
2026-01-30 09:53:53 2026-01-30 09:53:53,299 - routes.stock_routes - INFO - Found 95 existing stock levels to preserve
2026-01-30 09:53:53 2026-01-30 09:53:53,299 - routes.stock_routes - INFO - ? Step 1: Initializing stock_by_part with 6 mappings
2026-01-30 09:53:53 2026-01-30 09:53:53,299 - routes.stock_routes - INFO - ? Step 2: Filling IN transactions from 112 vendor invoices
2026-01-30 09:53:53 2026-01-30 09:53:53,304 - routes.stock_routes - INFO - ? Step 3: Building part-to-customer mapping for 95 parts
2026-01-30 09:53:53 2026-01-30 09:53:53,305 - routes.stock_routes - INFO - ? Step 4: Processing 211 sales transactions
2026-01-30 09:53:53 2026-01-30 09:53:53,360 - database - INFO - Batch upserting 95 records to 'stock_levels' in 1 batches
2026-01-30 09:53:53 2026-01-30 09:53:53,412 - database - INFO - ? Batch upsert complete: 95 records processed
2026-01-30 09:53:53 2026-01-30 09:53:53,412 - routes.stock_routes - INFO - ? Recalculated 95 stock levels for Adnak
2026-01-30 09:54:03 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:54:03 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:54:13 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:54:13 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:54:13 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/stock/levels/110377
2026-01-30 09:54:13 PATCH 404 https://digientry-backend-112233610459.asia-south1.run.app/api/stock/levels/110377
2026-01-30 09:54:18 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/stock/levels?status_filter=all&priority_filter=all&_t=1769766851990
2026-01-30 09:54:18 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/stock/summary
2026-01-30 09:54:18 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/stock/summary
2026-01-30 09:54:18 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/stock/levels?status_filter=all&priority_filter=all&_t=1769766851990
2026-01-30 09:54:18 2026-01-30 09:54:18,320 - routes.stock_routes - INFO - Retrieved 95 stock levels for Adnak
2026-01-30 09:54:23 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:54:23 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:54:33 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:54:33 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:54:33 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/stock/levels/110542
2026-01-30 09:54:33 PATCH 500 https://digientry-backend-112233610459.asia-south1.run.app/api/stock/levels/110542
2026-01-30 09:54:34 2026-01-30 09:54:34,298 - routes.stock_routes - ERROR - Error updating stock level: {'message': 'invalid input syntax for type integer: "20.0"', 'code': '22P02', 'hint': None, 'details': None}
2026-01-30 09:54:43 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:54:43 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:54:53 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:54:53 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:55:03 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:55:03 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:55:12 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:55:12 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:55:23 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:55:23 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:55:32 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:55:32 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:55:43 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:55:43 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:55:45 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/upload
2026-01-30 09:55:47 POST 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/upload
2026-01-30 09:55:48 2026-01-30 09:55:48,002 - routes.inventory - INFO - Received 3 files for inventory upload from Adnak
2026-01-30 09:55:48 2026-01-30 09:55:48,003 - routes.inventory - INFO - Generated 3 inventory file keys for upload
2026-01-30 09:55:48 2026-01-30 09:55:48,003 - routes.inventory - INFO - Scheduled 3 background inventory upload tasks
2026-01-30 09:55:48 2026-01-30 09:55:48,004 - routes.inventory - INFO - Skipping optimization for IMG_20260101_130418763.jpg
2026-01-30 09:55:48 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/process
2026-01-30 09:55:48 POST 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/process
2026-01-30 09:55:48 2026-01-30 09:55:48,267 - routes.inventory - INFO - === INVENTORY PROCESSING STARTED ===
2026-01-30 09:55:48 2026-01-30 09:55:48,268 - routes.inventory - INFO - Task ID: 56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:55:48 2026-01-30 09:55:48,268 - routes.inventory - INFO - Files: 3 R2 keys
2026-01-30 09:55:48 2026-01-30 09:55:48,268 - routes.inventory - INFO - User: Adnak
2026-01-30 09:55:48 2026-01-30 09:55:48,268 - routes.inventory - INFO - Phase 2: Processing inventory with AI...
2026-01-30 09:55:48 2026-01-30 09:55:48,268 - services.inventory_processor - INFO - Starting inventory batch processing: 3 files with 25 workers
2026-01-30 09:55:48 2026-01-30 09:55:48,268 - services.inventory_processor - INFO - Phase 2a: Pre-scanning for duplicates...
2026-01-30 09:55:48 2026-01-30 09:55:48,479 - services.storage - INFO - Uploaded to R2: adnak-sir-invoices/Adnak/purchases/20260130_095548_IMG_20260101_130418763.jpg
2026-01-30 09:55:48 2026-01-30 09:55:48,479 - routes.inventory - INFO - Uploaded inventory file: Adnak/purchases/20260130_095548_IMG_20260101_130418763.jpg
2026-01-30 09:55:48 2026-01-30 09:55:48,480 - routes.inventory - INFO - Skipping optimization for IMG_20260101_130426539.jpg
2026-01-30 09:55:48 2026-01-30 09:55:48,512 - services.storage - WARNING - File not found (attempt 1/5), retrying in 1.0s: adnak-sir-invoices/Adnak/purchases/20260130_095548_IMG_20260101_130433647.jpg
2026-01-30 09:55:48 2026-01-30 09:55:48,742 - services.storage - WARNING - File not found (attempt 1/5), retrying in 1.0s: adnak-sir-invoices/Adnak/purchases/20260130_095548_IMG_20260101_130426539.jpg
2026-01-30 09:55:49 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:55:49 2026-01-30 09:55:49,700 - services.storage - INFO - Uploaded to R2: adnak-sir-invoices/Adnak/purchases/20260130_095548_IMG_20260101_130426539.jpg
2026-01-30 09:55:49 2026-01-30 09:55:49,700 - routes.inventory - INFO - Uploaded inventory file: Adnak/purchases/20260130_095548_IMG_20260101_130426539.jpg
2026-01-30 09:55:49 2026-01-30 09:55:49,701 - routes.inventory - INFO - Skipping optimization for IMG_20260101_130433647.jpg
2026-01-30 09:55:49 2026-01-30 09:55:49,705 - services.storage - INFO - Downloaded from R2: adnak-sir-invoices/Adnak/purchases/20260130_095548_IMG_20260101_130418763.jpg
2026-01-30 09:55:49 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:55:49 2026-01-30 09:55:49,992 - services.storage - WARNING - File not found (attempt 2/5), retrying in 1.0s: adnak-sir-invoices/Adnak/purchases/20260130_095548_IMG_20260101_130433647.jpg
2026-01-30 09:55:50 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:55:50 2026-01-30 09:55:50,744 - services.storage - INFO - Uploaded to R2: adnak-sir-invoices/Adnak/purchases/20260130_095548_IMG_20260101_130433647.jpg
2026-01-30 09:55:50 2026-01-30 09:55:50,744 - routes.inventory - INFO - Uploaded inventory file: Adnak/purchases/20260130_095548_IMG_20260101_130433647.jpg
2026-01-30 09:55:50 2026-01-30 09:55:50,747 - services.storage - INFO - Downloaded from R2 on attempt 2: adnak-sir-invoices/Adnak/purchases/20260130_095548_IMG_20260101_130426539.jpg
2026-01-30 09:55:50 2026-01-30 09:55:50,812 - services.inventory_processor - WARNING - Duplicate detected for Adnak/purchases/20260130_095548_IMG_20260101_130426539.jpg: image_hash=765793abd2190a1c8b485488e01b61e541b9fad58f1edf1696ec0b46fa8d7de4
2026-01-30 09:55:51 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:55:51 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:55:52 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:55:52 2026-01-30 09:55:52,291 - services.storage - INFO - Downloaded from R2 on attempt 3: adnak-sir-invoices/Adnak/purchases/20260130_095548_IMG_20260101_130433647.jpg
2026-01-30 09:55:52 2026-01-30 09:55:52,342 - services.inventory_processor - INFO - Duplicate scan found 1 duplicates. Stopping batch to request user action.
2026-01-30 09:55:52 2026-01-30 09:55:52,343 - routes.inventory - INFO - Processing completed. Results: {'processed': 0, 'failed': 0, 'errors': [], 'duplicates': [{'file_key': 'Adnak/purchases/20260130_095548_IMG_20260101_130426539.jpg', 'image_hash': '765793abd2190a1c8b485488e01b61e541b9fad58f1edf1696ec0b46fa8d7de4', 'existing_record': {'id': 1399, 'invoice_number': '22/RS/25005511', 'invoice_date': '2025-09-19', 'receipt_link': 'https://pub-3de23488ca6c4e2392d96de04f8c5cff.r2.dev/Adnak/purchases/20260130_094550_IMG_20260101_130426539.jpg', 'upload_date': None, 'part_number': '11610M55RA1', 'description': 'MOUNTING COMP ENG RH'}, 'message': 'This vendor invoice was already uploaded previously'}]}
2026-01-30 09:55:52 2026-01-30 09:55:52,343 - routes.inventory - INFO - Duplicates detected: 1
2026-01-30 09:55:52 2026-01-30 09:55:52,343 - routes.inventory - INFO - === INVENTORY PROCESSING COMPLETED ===
2026-01-30 09:55:52 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:55:52 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:55:52 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:55:53 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:55:55 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:55:55 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:55:56 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:55:57 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:55:58 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:55:59 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:56:00 POST 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/process
2026-01-30 09:56:00 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:56:00 2026-01-30 09:56:00,535 - routes.inventory - INFO - === INVENTORY PROCESSING STARTED ===
2026-01-30 09:56:00 2026-01-30 09:56:00,535 - routes.inventory - INFO - Task ID: 813abb93-9de9-4148-952e-5ccb5837a91e
2026-01-30 09:56:00 2026-01-30 09:56:00,536 - routes.inventory - INFO - Files: 2 R2 keys
2026-01-30 09:56:00 2026-01-30 09:56:00,536 - routes.inventory - INFO - User: Adnak
2026-01-30 09:56:00 2026-01-30 09:56:00,536 - routes.inventory - INFO - Phase 2: Processing inventory with AI...
2026-01-30 09:56:00 2026-01-30 09:56:00,537 - services.inventory_processor - INFO - Starting inventory batch processing: 2 files with 25 workers
2026-01-30 09:56:00 2026-01-30 09:56:00,537 - services.inventory_processor - INFO - Phase 2b: AI Processing...
2026-01-30 09:56:01 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:56:01 2026-01-30 09:56:01,308 - services.storage - INFO - Downloaded from R2: adnak-sir-invoices/Adnak/purchases/20260130_095548_IMG_20260101_130418763.jpg
2026-01-30 09:56:01 2026-01-30 09:56:01,310 - services.inventory_processor - INFO - Force upload enabled. Deleting existing items with hash adb1883840ea9e6c519fd813102c449553c3a58dc9a4dc2edd1a4ca01ab42ff6 for replacement.
2026-01-30 09:56:01 2026-01-30 09:56:01,312 - services.storage - INFO - Downloaded from R2: adnak-sir-invoices/Adnak/purchases/20260130_095548_IMG_20260101_130433647.jpg
2026-01-30 09:56:01 2026-01-30 09:56:01,313 - services.inventory_processor - INFO - Force upload enabled. Deleting existing items with hash 7a3420d9fc1c5d4d8045ab77424079cf87d68fcabf5dcd297e4ca37188dd2705 for replacement.
2026-01-30 09:56:01 2026-01-30 09:56:01,385 - services.inventory_processor - INFO - Processing vendor invoice: 20260130_095548_IMG_20260101_130433647.jpg
2026-01-30 09:56:01 2026-01-30 09:56:01,386 - services.inventory_processor - INFO - Processing vendor invoice: 20260130_095548_IMG_20260101_130418763.jpg
2026-01-30 09:56:01 2026-01-30 09:56:01,419 - services.inventory_processor - INFO - Trying gemini-3-flash-preview for vendor invoice extraction...
2026-01-30 09:56:01 2026-01-30 09:56:01,420 - services.inventory_processor - INFO - Trying gemini-3-flash-preview for vendor invoice extraction...
2026-01-30 09:56:01 2026-01-30 09:56:01,420 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-30 09:56:01 2026-01-30 09:56:01,421 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-30 09:56:01 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/813abb93-9de9-4148-952e-5ccb5837a91e
2026-01-30 09:56:01 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/813abb93-9de9-4148-952e-5ccb5837a91e
2026-01-30 09:56:02 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:56:02 POST 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/process
2026-01-30 09:56:02 2026-01-30 09:56:02,464 - routes.inventory - INFO - === INVENTORY PROCESSING STARTED ===
2026-01-30 09:56:02 2026-01-30 09:56:02,465 - routes.inventory - INFO - Task ID: 0e01f45b-af79-4593-bd33-b3b545fec04c
2026-01-30 09:56:02 2026-01-30 09:56:02,465 - routes.inventory - INFO - Files: 2 R2 keys
2026-01-30 09:56:02 2026-01-30 09:56:02,465 - routes.inventory - INFO - User: Adnak
2026-01-30 09:56:02 2026-01-30 09:56:02,465 - routes.inventory - INFO - Phase 2: Processing inventory with AI...
2026-01-30 09:56:02 2026-01-30 09:56:02,468 - services.inventory_processor - INFO - Starting inventory batch processing: 2 files with 25 workers
2026-01-30 09:56:02 2026-01-30 09:56:02,468 - services.inventory_processor - INFO - Phase 2b: AI Processing...
2026-01-30 09:56:02 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/813abb93-9de9-4148-952e-5ccb5837a91e
2026-01-30 09:56:03 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:56:03 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:56:03 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:56:03 2026-01-30 09:56:03,447 - services.storage - INFO - R2 storage client initialized
2026-01-30 09:56:03 2026-01-30 09:56:03,477 - services.storage - INFO - R2 storage client initialized
2026-01-30 09:56:04 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/813abb93-9de9-4148-952e-5ccb5837a91e
2026-01-30 09:56:04 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/0e01f45b-af79-4593-bd33-b3b545fec04c
2026-01-30 09:56:04 2026-01-30 09:56:04,115 - services.storage - INFO - Downloaded from R2: adnak-sir-invoices/Adnak/purchases/20260130_095548_IMG_20260101_130418763.jpg
2026-01-30 09:56:04 2026-01-30 09:56:04,118 - services.inventory_processor - INFO - Force upload enabled. Deleting existing items with hash adb1883840ea9e6c519fd813102c449553c3a58dc9a4dc2edd1a4ca01ab42ff6 for replacement.
2026-01-30 09:56:04 2026-01-30 09:56:04,170 - services.inventory_processor - INFO - Processing vendor invoice: 20260130_095548_IMG_20260101_130418763.jpg
2026-01-30 09:56:04 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/0e01f45b-af79-4593-bd33-b3b545fec04c
2026-01-30 09:56:04 2026-01-30 09:56:04,199 - services.inventory_processor - INFO - Trying gemini-3-flash-preview for vendor invoice extraction...
2026-01-30 09:56:04 2026-01-30 09:56:04,199 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-30 09:56:04 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:56:04 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/813abb93-9de9-4148-952e-5ccb5837a91e
2026-01-30 09:56:04 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/0e01f45b-af79-4593-bd33-b3b545fec04c
2026-01-30 09:56:04 2026-01-30 09:56:04,899 - services.storage - INFO - Downloaded from R2: adnak-sir-invoices/Adnak/purchases/20260130_095548_IMG_20260101_130433647.jpg
2026-01-30 09:56:04 2026-01-30 09:56:04,901 - services.inventory_processor - INFO - Force upload enabled. Deleting existing items with hash 7a3420d9fc1c5d4d8045ab77424079cf87d68fcabf5dcd297e4ca37188dd2705 for replacement.
2026-01-30 09:56:04 2026-01-30 09:56:04,944 - services.inventory_processor - INFO - Processing vendor invoice: 20260130_095548_IMG_20260101_130433647.jpg
2026-01-30 09:56:04 2026-01-30 09:56:04,973 - services.inventory_processor - INFO - Trying gemini-3-flash-preview for vendor invoice extraction...
2026-01-30 09:56:04 2026-01-30 09:56:04,974 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-30 09:56:05 POST 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/process
2026-01-30 09:56:05 2026-01-30 09:56:05,218 - routes.inventory - INFO - === INVENTORY PROCESSING STARTED ===
2026-01-30 09:56:05 2026-01-30 09:56:05,218 - routes.inventory - INFO - Task ID: 6619f2d9-e91b-4a6a-8fdf-466472115ec4
2026-01-30 09:56:05 2026-01-30 09:56:05,219 - routes.inventory - INFO - Files: 2 R2 keys
2026-01-30 09:56:05 2026-01-30 09:56:05,219 - routes.inventory - INFO - User: Adnak
2026-01-30 09:56:05 2026-01-30 09:56:05,219 - routes.inventory - INFO - Phase 2: Processing inventory with AI...
2026-01-30 09:56:05 2026-01-30 09:56:05,219 - services.inventory_processor - INFO - Starting inventory batch processing: 2 files with 25 workers
2026-01-30 09:56:05 2026-01-30 09:56:05,219 - services.inventory_processor - INFO - Phase 2b: AI Processing...
2026-01-30 09:56:05 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:56:05 2026-01-30 09:56:05,423 - services.storage - INFO - Downloaded from R2: adnak-sir-invoices/Adnak/purchases/20260130_095548_IMG_20260101_130418763.jpg
2026-01-30 09:56:05 2026-01-30 09:56:05,425 - services.inventory_processor - INFO - Force upload enabled. Deleting existing items with hash adb1883840ea9e6c519fd813102c449553c3a58dc9a4dc2edd1a4ca01ab42ff6 for replacement.
2026-01-30 09:56:05 2026-01-30 09:56:05,511 - services.inventory_processor - INFO - Processing vendor invoice: 20260130_095548_IMG_20260101_130418763.jpg
2026-01-30 09:56:05 2026-01-30 09:56:05,537 - services.inventory_processor - INFO - Trying gemini-3-flash-preview for vendor invoice extraction...
2026-01-30 09:56:05 2026-01-30 09:56:05,537 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-30 09:56:05 2026-01-30 09:56:05,568 - services.storage - INFO - Downloaded from R2: adnak-sir-invoices/Adnak/purchases/20260130_095548_IMG_20260101_130433647.jpg
2026-01-30 09:56:05 2026-01-30 09:56:05,570 - services.inventory_processor - INFO - Force upload enabled. Deleting existing items with hash 7a3420d9fc1c5d4d8045ab77424079cf87d68fcabf5dcd297e4ca37188dd2705 for replacement.
2026-01-30 09:56:06 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/813abb93-9de9-4148-952e-5ccb5837a91e
2026-01-30 09:56:06 2026-01-30 09:56:06,171 - services.inventory_processor - INFO - Processing vendor invoice: 20260130_095548_IMG_20260101_130433647.jpg
2026-01-30 09:56:06 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/0e01f45b-af79-4593-bd33-b3b545fec04c
2026-01-30 09:56:06 2026-01-30 09:56:06,195 - services.inventory_processor - INFO - Trying gemini-3-flash-preview for vendor invoice extraction...
2026-01-30 09:56:06 2026-01-30 09:56:06,195 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-30 09:56:06 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:56:06 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/6619f2d9-e91b-4a6a-8fdf-466472115ec4
2026-01-30 09:56:06 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/813abb93-9de9-4148-952e-5ccb5837a91e
2026-01-30 09:56:06 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/0e01f45b-af79-4593-bd33-b3b545fec04c
2026-01-30 09:56:06 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/6619f2d9-e91b-4a6a-8fdf-466472115ec4
2026-01-30 09:56:07 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:56:07 POST 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/process
2026-01-30 09:56:07 2026-01-30 09:56:07,463 - routes.inventory - INFO - === INVENTORY PROCESSING STARTED ===
2026-01-30 09:56:07 2026-01-30 09:56:07,463 - routes.inventory - INFO - Task ID: 19e1573c-c52c-49b8-92ac-989cd0408772
2026-01-30 09:56:07 2026-01-30 09:56:07,463 - routes.inventory - INFO - Files: 2 R2 keys
2026-01-30 09:56:07 2026-01-30 09:56:07,463 - routes.inventory - INFO - User: Adnak
2026-01-30 09:56:07 2026-01-30 09:56:07,463 - routes.inventory - INFO - Phase 2: Processing inventory with AI...
2026-01-30 09:56:07 2026-01-30 09:56:07,463 - services.inventory_processor - INFO - Starting inventory batch processing: 2 files with 25 workers
2026-01-30 09:56:07 2026-01-30 09:56:07,463 - services.inventory_processor - INFO - Phase 2b: AI Processing...
2026-01-30 09:56:07 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/813abb93-9de9-4148-952e-5ccb5837a91e
2026-01-30 09:56:07 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/6619f2d9-e91b-4a6a-8fdf-466472115ec4
2026-01-30 09:56:07 2026-01-30 09:56:07,888 - services.storage - INFO - Downloaded from R2: adnak-sir-invoices/Adnak/purchases/20260130_095548_IMG_20260101_130433647.jpg
2026-01-30 09:56:07 2026-01-30 09:56:07,889 - services.inventory_processor - INFO - Force upload enabled. Deleting existing items with hash 7a3420d9fc1c5d4d8045ab77424079cf87d68fcabf5dcd297e4ca37188dd2705 for replacement.
2026-01-30 09:56:07 2026-01-30 09:56:07,925 - services.inventory_processor - INFO - Processing vendor invoice: 20260130_095548_IMG_20260101_130433647.jpg
2026-01-30 09:56:07 2026-01-30 09:56:07,945 - services.inventory_processor - INFO - Trying gemini-3-flash-preview for vendor invoice extraction...
2026-01-30 09:56:07 2026-01-30 09:56:07,945 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-30 09:56:08 2026-01-30 09:56:08,022 - services.storage - INFO - Downloaded from R2: adnak-sir-invoices/Adnak/purchases/20260130_095548_IMG_20260101_130418763.jpg
2026-01-30 09:56:08 2026-01-30 09:56:08,024 - services.inventory_processor - INFO - Force upload enabled. Deleting existing items with hash adb1883840ea9e6c519fd813102c449553c3a58dc9a4dc2edd1a4ca01ab42ff6 for replacement.
2026-01-30 09:56:08 2026-01-30 09:56:08,064 - services.inventory_processor - INFO - Processing vendor invoice: 20260130_095548_IMG_20260101_130418763.jpg
2026-01-30 09:56:08 2026-01-30 09:56:08,087 - services.inventory_processor - INFO - Trying gemini-3-flash-preview for vendor invoice extraction...
2026-01-30 09:56:08 2026-01-30 09:56:08,087 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-30 09:56:08 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/0e01f45b-af79-4593-bd33-b3b545fec04c
2026-01-30 09:56:08 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:56:08 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/6619f2d9-e91b-4a6a-8fdf-466472115ec4
2026-01-30 09:56:08 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/813abb93-9de9-4148-952e-5ccb5837a91e
2026-01-30 09:56:08 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/0e01f45b-af79-4593-bd33-b3b545fec04c
2026-01-30 09:56:09 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/19e1573c-c52c-49b8-92ac-989cd0408772
2026-01-30 09:56:09 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:56:09 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/6619f2d9-e91b-4a6a-8fdf-466472115ec4
2026-01-30 09:56:09 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/19e1573c-c52c-49b8-92ac-989cd0408772
2026-01-30 09:56:09 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/813abb93-9de9-4148-952e-5ccb5837a91e
2026-01-30 09:56:10 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/0e01f45b-af79-4593-bd33-b3b545fec04c
2026-01-30 09:56:10 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/19e1573c-c52c-49b8-92ac-989cd0408772
2026-01-30 09:56:10 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/56a4be85-25d1-42b4-836d-372575c59f97
2026-01-30 09:56:11 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/auth/me
2026-01-30 09:56:11 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/auth/me
2026-01-30 09:56:12 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:56:12 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:56:20 2026-01-30 09:56:20,942 - services.inventory_processor - INFO - ? Vendor invoice processed: 20260130_095548_IMG_20260101_130418763.jpg (Model: Flash, Accuracy: 98.0%)
2026-01-30 09:56:22 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:56:22 2026-01-30 09:56:22,056 - services.inventory_processor - INFO - ? Vendor invoice processed: 20260130_095548_IMG_20260101_130418763.jpg (Model: Flash, Accuracy: 99.0%)
2026-01-30 09:56:22 2026-01-30 09:56:22,057 - services.inventory_processor - INFO - ? Vendor invoice processed: 20260130_095548_IMG_20260101_130418763.jpg (Model: Flash, Accuracy: 99.0%)
2026-01-30 09:56:22 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:56:22 2026-01-30 09:56:22,150 - services.inventory_processor - ERROR - Error saving to inventory_items: {'message': 'duplicate key value violates unique constraint "inventory_items_row_id_key"', 'code': '23505', 'hint': None, 'details': 'Key (row_id)=(22/RS/25005508_0) already exists.'}
2026-01-30 09:56:22 2026-01-30 09:56:22,150 - services.inventory_processor - ERROR - Failed to process Adnak/purchases/20260130_095548_IMG_20260101_130418763.jpg: {'message': 'duplicate key value violates unique constraint "inventory_items_row_id_key"', 'code': '23505', 'hint': None, 'details': 'Key (row_id)=(22/RS/25005508_0) already exists.'}
2026-01-30 09:56:22 2026-01-30 09:56:22,150 - routes.inventory - INFO - Progress: 1/2 (Failed: 1) - Adnak/purchases/20260130_095548_IMG_20260101_130418763.jpg
2026-01-30 09:56:22 2026-01-30 09:56:22,159 - services.inventory_processor - INFO - ? Saved 5 rows to inventory_items table
2026-01-30 09:56:22 2026-01-30 09:56:22,159 - services.inventory_processor - INFO - ? Successfully processed inventory item: Adnak/purchases/20260130_095548_IMG_20260101_130418763.jpg
2026-01-30 09:56:22 2026-01-30 09:56:22,159 - routes.inventory - INFO - Progress: 1/2 (Failed: 0) - Adnak/purchases/20260130_095548_IMG_20260101_130418763.jpg
2026-01-30 09:56:22 2026-01-30 09:56:22,160 - services.inventory_processor - ERROR - Error saving to inventory_items: {'message': 'duplicate key value violates unique constraint "inventory_items_row_id_key"', 'code': '23505', 'hint': None, 'details': 'Key (row_id)=(22/RS/25005508_0) already exists.'}
2026-01-30 09:56:22 2026-01-30 09:56:22,160 - services.inventory_processor - ERROR - Failed to process Adnak/purchases/20260130_095548_IMG_20260101_130418763.jpg: {'message': 'duplicate key value violates unique constraint "inventory_items_row_id_key"', 'code': '23505', 'hint': None, 'details': 'Key (row_id)=(22/RS/25005508_0) already exists.'}
2026-01-30 09:56:22 2026-01-30 09:56:22,160 - routes.inventory - INFO - Progress: 1/2 (Failed: 1) - Adnak/purchases/20260130_095548_IMG_20260101_130418763.jpg
2026-01-30 09:56:31 2026-01-30 09:56:31,842 - services.inventory_processor - INFO - ? Vendor invoice processed: 20260130_095548_IMG_20260101_130433647.jpg (Model: Flash, Accuracy: 100.0%)
2026-01-30 09:56:32 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:56:32 2026-01-30 09:56:32,142 - services.inventory_processor - INFO - ? Vendor invoice processed: 20260130_095548_IMG_20260101_130433647.jpg (Model: Flash, Accuracy: 100.0%)
2026-01-30 09:56:32 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:56:32 2026-01-30 09:56:32,204 - services.inventory_processor - ERROR - Error saving to inventory_items: {'message': 'duplicate key value violates unique constraint "inventory_items_row_id_key"', 'code': '23505', 'hint': None, 'details': 'Key (row_id)=(22/RS/25005512_0) already exists.'}
2026-01-30 09:56:32 2026-01-30 09:56:32,210 - services.inventory_processor - ERROR - Failed to process Adnak/purchases/20260130_095548_IMG_20260101_130433647.jpg: {'message': 'duplicate key value violates unique constraint "inventory_items_row_id_key"', 'code': '23505', 'hint': None, 'details': 'Key (row_id)=(22/RS/25005512_0) already exists.'}
2026-01-30 09:56:32 2026-01-30 09:56:32,210 - services.inventory_processor - ERROR - Error saving to inventory_items: {'message': 'duplicate key value violates unique constraint "inventory_items_row_id_key"', 'code': '23505', 'hint': None, 'details': 'Key (row_id)=(22/RS/25005512_0) already exists.'}
2026-01-30 09:56:32 2026-01-30 09:56:32,211 - services.inventory_processor - ERROR - Failed to process Adnak/purchases/20260130_095548_IMG_20260101_130433647.jpg: {'message': 'duplicate key value violates unique constraint "inventory_items_row_id_key"', 'code': '23505', 'hint': None, 'details': 'Key (row_id)=(22/RS/25005512_0) already exists.'}
2026-01-30 09:56:32 2026-01-30 09:56:32,211 - routes.inventory - INFO - Progress: 2/2 (Failed: 2) - Adnak/purchases/20260130_095548_IMG_20260101_130433647.jpg
2026-01-30 09:56:32 2026-01-30 09:56:32,213 - services.inventory_processor - INFO - Inventory batch processing complete: 0 succeeded, 2 failed, 0 duplicates
2026-01-30 09:56:32 2026-01-30 09:56:32,213 - routes.inventory - INFO - Processing completed. Results: {'processed': 0, 'failed': 2, 'errors': ['Failed to process Adnak/purchases/20260130_095548_IMG_20260101_130418763.jpg: {\'message\': \'duplicate key value violates unique constraint "inventory_items_row_id_key"\', \'code\': \'23505\', \'hint\': None, \'details\': \'Key (row_id)=(22/RS/25005508_0) already exists.\'}', 'Failed to process Adnak/purchases/20260130_095548_IMG_20260101_130433647.jpg: {\'message\': \'duplicate key value violates unique constraint "inventory_items_row_id_key"\', \'code\': \'23505\', \'hint\': None, \'details\': \'Key (row_id)=(22/RS/25005512_0) already exists.\'}'], 'duplicates': []}
2026-01-30 09:56:32 2026-01-30 09:56:32,214 - routes.inventory - WARNING - Processing errors: ['Failed to process Adnak/purchases/20260130_095548_IMG_20260101_130418763.jpg: {\'message\': \'duplicate key value violates unique constraint "inventory_items_row_id_key"\', \'code\': \'23505\', \'hint\': None, \'details\': \'Key (row_id)=(22/RS/25005508_0) already exists.\'}', 'Failed to process Adnak/purchases/20260130_095548_IMG_20260101_130433647.jpg: {\'message\': \'duplicate key value violates unique constraint "inventory_items_row_id_key"\', \'code\': \'23505\', \'hint\': None, \'details\': \'Key (row_id)=(22/RS/25005512_0) already exists.\'}']
2026-01-30 09:56:32 2026-01-30 09:56:32,214 - routes.inventory - INFO - === INVENTORY PROCESSING COMPLETED ===
2026-01-30 09:56:32 2026-01-30 09:56:32,217 - routes.inventory - INFO - Progress: 2/2 (Failed: 1) - Adnak/purchases/20260130_095548_IMG_20260101_130433647.jpg
2026-01-30 09:56:32 2026-01-30 09:56:32,217 - services.inventory_processor - INFO - Inventory batch processing complete: 1 succeeded, 1 failed, 0 duplicates
2026-01-30 09:56:32 2026-01-30 09:56:32,217 - routes.inventory - INFO - Processing completed. Results: {'processed': 1, 'failed': 1, 'errors': ['Failed to process Adnak/purchases/20260130_095548_IMG_20260101_130433647.jpg: {\'message\': \'duplicate key value violates unique constraint "inventory_items_row_id_key"\', \'code\': \'23505\', \'hint\': None, \'details\': \'Key (row_id)=(22/RS/25005512_0) already exists.\'}'], 'duplicates': []}
2026-01-30 09:56:32 2026-01-30 09:56:32,218 - routes.inventory - WARNING - Processing errors: ['Failed to process Adnak/purchases/20260130_095548_IMG_20260101_130433647.jpg: {\'message\': \'duplicate key value violates unique constraint "inventory_items_row_id_key"\', \'code\': \'23505\', \'hint\': None, \'details\': \'Key (row_id)=(22/RS/25005512_0) already exists.\'}']
2026-01-30 09:56:32 2026-01-30 09:56:32,218 - routes.inventory - INFO - === INVENTORY PROCESSING COMPLETED ===
2026-01-30 09:56:33 POST 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/upload
2026-01-30 09:56:33 2026-01-30 09:56:33,173 - services.inventory_processor - INFO - ? Vendor invoice processed: 20260130_095548_IMG_20260101_130433647.jpg (Model: Flash, Accuracy: 100.0%)
2026-01-30 09:56:33 2026-01-30 09:56:33,189 - routes.inventory - INFO - Received 2 files for inventory upload from Adnak
2026-01-30 09:56:33 2026-01-30 09:56:33,190 - routes.inventory - INFO - Generated 2 inventory file keys for upload
2026-01-30 09:56:33 2026-01-30 09:56:33,190 - routes.inventory - INFO - Scheduled 2 background inventory upload tasks
2026-01-30 09:56:33 2026-01-30 09:56:33,199 - routes.inventory - INFO - Skipping optimization for IMG_20260101_123454872.jpg
2026-01-30 09:56:33 2026-01-30 09:56:33,241 - services.inventory_processor - ERROR - Error saving to inventory_items: {'message': 'duplicate key value violates unique constraint "inventory_items_row_id_key"', 'code': '23505', 'hint': None, 'details': 'Key (row_id)=(22/RS/25005512_0) already exists.'}
2026-01-30 09:56:33 2026-01-30 09:56:33,241 - services.inventory_processor - ERROR - Failed to process Adnak/purchases/20260130_095548_IMG_20260101_130433647.jpg: {'message': 'duplicate key value violates unique constraint "inventory_items_row_id_key"', 'code': '23505', 'hint': None, 'details': 'Key (row_id)=(22/RS/25005512_0) already exists.'}
2026-01-30 09:56:33 2026-01-30 09:56:33,241 - routes.inventory - INFO - Progress: 1/2 (Failed: 1) - Adnak/purchases/20260130_095548_IMG_20260101_130433647.jpg
2026-01-30 09:56:33 POST 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/process
2026-01-30 09:56:33 2026-01-30 09:56:33,435 - routes.inventory - INFO - === INVENTORY PROCESSING STARTED ===
2026-01-30 09:56:33 2026-01-30 09:56:33,436 - routes.inventory - INFO - Task ID: cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:33 2026-01-30 09:56:33,436 - routes.inventory - INFO - Files: 2 R2 keys
2026-01-30 09:56:33 2026-01-30 09:56:33,436 - routes.inventory - INFO - User: Adnak
2026-01-30 09:56:33 2026-01-30 09:56:33,436 - routes.inventory - INFO - Phase 2: Processing inventory with AI...
2026-01-30 09:56:33 2026-01-30 09:56:33,439 - services.inventory_processor - INFO - Starting inventory batch processing: 2 files with 25 workers
2026-01-30 09:56:33 2026-01-30 09:56:33,440 - services.inventory_processor - INFO - Phase 2a: Pre-scanning for duplicates...
2026-01-30 09:56:34 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:34 2026-01-30 09:56:34,593 - services.storage - INFO - Uploaded to R2: adnak-sir-invoices/Adnak/purchases/20260130_095633_IMG_20260101_123454872.jpg
2026-01-30 09:56:34 2026-01-30 09:56:34,593 - routes.inventory - INFO - Uploaded inventory file: Adnak/purchases/20260130_095633_IMG_20260101_123454872.jpg
2026-01-30 09:56:34 2026-01-30 09:56:34,594 - routes.inventory - INFO - Skipping optimization for IMG_20260101_130518432.jpg
2026-01-30 09:56:34 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:35 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:35 2026-01-30 09:56:35,208 - services.storage - INFO - R2 storage client initialized
2026-01-30 09:56:35 2026-01-30 09:56:35,213 - services.storage - INFO - R2 storage client initialized
2026-01-30 09:56:35 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:35 2026-01-30 09:56:35,536 - services.storage - INFO - Uploaded to R2: adnak-sir-invoices/Adnak/purchases/20260130_095633_IMG_20260101_130518432.jpg
2026-01-30 09:56:35 2026-01-30 09:56:35,537 - routes.inventory - INFO - Uploaded inventory file: Adnak/purchases/20260130_095633_IMG_20260101_130518432.jpg
2026-01-30 09:56:35 2026-01-30 09:56:35,539 - services.storage - WARNING - File not found (attempt 1/5), retrying in 1.0s: adnak-sir-invoices/Adnak/purchases/20260130_095633_IMG_20260101_130518432.jpg
2026-01-30 09:56:35 2026-01-30 09:56:35,637 - services.storage - INFO - Downloaded from R2: adnak-sir-invoices/Adnak/purchases/20260130_095633_IMG_20260101_123454872.jpg
2026-01-30 09:56:36 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:37 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:37 2026-01-30 09:56:37,558 - services.storage - INFO - Downloaded from R2 on attempt 2: adnak-sir-invoices/Adnak/purchases/20260130_095633_IMG_20260101_130518432.jpg
2026-01-30 09:56:37 2026-01-30 09:56:37,594 - services.inventory_processor - INFO - No duplicates found in pre-scan. Proceeding to processing.
2026-01-30 09:56:37 2026-01-30 09:56:37,594 - services.inventory_processor - INFO - Phase 2b: AI Processing...
2026-01-30 09:56:38 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:38 2026-01-30 09:56:38,547 - services.storage - INFO - Downloaded from R2: adnak-sir-invoices/Adnak/purchases/20260130_095633_IMG_20260101_123454872.jpg
2026-01-30 09:56:38 2026-01-30 09:56:38,552 - services.storage - INFO - Downloaded from R2: adnak-sir-invoices/Adnak/purchases/20260130_095633_IMG_20260101_130518432.jpg
2026-01-30 09:56:38 2026-01-30 09:56:38,577 - services.inventory_processor - INFO - Processing vendor invoice: 20260130_095633_IMG_20260101_123454872.jpg
2026-01-30 09:56:38 2026-01-30 09:56:38,577 - services.inventory_processor - INFO - Processing vendor invoice: 20260130_095633_IMG_20260101_130518432.jpg
2026-01-30 09:56:38 2026-01-30 09:56:38,612 - services.inventory_processor - INFO - Trying gemini-3-flash-preview for vendor invoice extraction...
2026-01-30 09:56:38 2026-01-30 09:56:38,612 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-30 09:56:38 2026-01-30 09:56:38,613 - services.inventory_processor - INFO - Trying gemini-3-flash-preview for vendor invoice extraction...
2026-01-30 09:56:38 2026-01-30 09:56:38,614 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2026-01-30 09:56:39 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:40 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:41 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:42 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:56:42 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:56:42 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:43 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:44 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:45 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:46 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:47 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:48 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:49 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:50 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:51 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:52 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:56:52 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:56:52 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:53 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:54 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:55 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:56 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:57 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:58 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:56:59 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:57:00 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:57:01 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:57:02 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:57:02 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:57:03 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:57:04 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:57:05 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:57:06 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:57:06 2026-01-30 09:57:06,173 - services.inventory_processor - INFO - ? Vendor invoice processed: 20260130_095633_IMG_20260101_130518432.jpg (Model: Flash, Accuracy: 100.0%)
2026-01-30 09:57:06 2026-01-30 09:57:06,315 - services.inventory_processor - ERROR - Error saving to inventory_items: {'message': 'duplicate key value violates unique constraint "inventory_items_row_id_key"', 'code': '23505', 'hint': None, 'details': 'Key (row_id)=(22/RS/25005647_0) already exists.'}
2026-01-30 09:57:06 2026-01-30 09:57:06,316 - services.inventory_processor - ERROR - Failed to process Adnak/purchases/20260130_095633_IMG_20260101_130518432.jpg: {'message': 'duplicate key value violates unique constraint "inventory_items_row_id_key"', 'code': '23505', 'hint': None, 'details': 'Key (row_id)=(22/RS/25005647_0) already exists.'}
2026-01-30 09:57:06 2026-01-30 09:57:06,316 - routes.inventory - INFO - Progress: 1/2 (Failed: 1) - Adnak/purchases/20260130_095633_IMG_20260101_130518432.jpg
2026-01-30 09:57:07 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:57:08 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:57:09 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:57:10 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:57:11 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:57:12 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:57:12 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:57:12 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:57:13 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:57:14 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:57:14 2026-01-30 09:57:14,263 - services.inventory_processor - INFO - ? Vendor invoice processed: 20260130_095633_IMG_20260101_123454872.jpg (Model: Flash, Accuracy: 99.72222222222223%)
2026-01-30 09:57:14 2026-01-30 09:57:14,357 - services.inventory_processor - INFO - ? Saved 18 rows to inventory_items table
2026-01-30 09:57:14 2026-01-30 09:57:14,357 - services.inventory_processor - INFO - ? Successfully processed inventory item: Adnak/purchases/20260130_095633_IMG_20260101_123454872.jpg
2026-01-30 09:57:14 2026-01-30 09:57:14,357 - routes.inventory - INFO - Progress: 2/2 (Failed: 1) - Adnak/purchases/20260130_095633_IMG_20260101_123454872.jpg
2026-01-30 09:57:14 2026-01-30 09:57:14,358 - services.inventory_processor - INFO - Inventory batch processing complete: 1 succeeded, 1 failed, 0 duplicates
2026-01-30 09:57:14 2026-01-30 09:57:14,358 - routes.inventory - INFO - Processing completed. Results: {'processed': 1, 'failed': 1, 'errors': ['Failed to process Adnak/purchases/20260130_095633_IMG_20260101_130518432.jpg: {\'message\': \'duplicate key value violates unique constraint "inventory_items_row_id_key"\', \'code\': \'23505\', \'hint\': None, \'details\': \'Key (row_id)=(22/RS/25005647_0) already exists.\'}'], 'duplicates': []}
2026-01-30 09:57:14 2026-01-30 09:57:14,358 - routes.inventory - WARNING - Processing errors: ['Failed to process Adnak/purchases/20260130_095633_IMG_20260101_130518432.jpg: {\'message\': \'duplicate key value violates unique constraint "inventory_items_row_id_key"\', \'code\': \'23505\', \'hint\': None, \'details\': \'Key (row_id)=(22/RS/25005647_0) already exists.\'}']
2026-01-30 09:57:14 2026-01-30 09:57:14,358 - routes.inventory - INFO - === INVENTORY PROCESSING COMPLETED ===
2026-01-30 09:57:15 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:57:16 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:57:17 GET 404 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:57:18 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/inventory/status/cee8a128-8d66-4bd3-afc2-116f9bb61de5
2026-01-30 09:57:22 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:57:22 2026-01-30 09:57:22,183 - services.inventory_processor - INFO - ? Vendor invoice processed: 20260130_095548_IMG_20260101_130418763.jpg (Model: Flash, Accuracy: 97.4%)
2026-01-30 09:57:22 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:57:22 2026-01-30 09:57:22,253 - services.inventory_processor - ERROR - Error saving to inventory_items: {'message': 'duplicate key value violates unique constraint "inventory_items_row_id_key"', 'code': '23505', 'hint': None, 'details': 'Key (row_id)=(22/RS/25005508_0) already exists.'}
2026-01-30 09:57:22 2026-01-30 09:57:22,253 - services.inventory_processor - ERROR - Failed to process Adnak/purchases/20260130_095548_IMG_20260101_130418763.jpg: {'message': 'duplicate key value violates unique constraint "inventory_items_row_id_key"', 'code': '23505', 'hint': None, 'details': 'Key (row_id)=(22/RS/25005508_0) already exists.'}
2026-01-30 09:57:22 2026-01-30 09:57:22,253 - routes.inventory - INFO - Progress: 2/2 (Failed: 2) - Adnak/purchases/20260130_095548_IMG_20260101_130418763.jpg
2026-01-30 09:57:22 2026-01-30 09:57:22,254 - services.inventory_processor - INFO - Inventory batch processing complete: 0 succeeded, 2 failed, 0 duplicates
2026-01-30 09:57:22 2026-01-30 09:57:22,254 - routes.inventory - INFO - Processing completed. Results: {'processed': 0, 'failed': 2, 'errors': ['Failed to process Adnak/purchases/20260130_095548_IMG_20260101_130433647.jpg: {\'message\': \'duplicate key value violates unique constraint "inventory_items_row_id_key"\', \'code\': \'23505\', \'hint\': None, \'details\': \'Key (row_id)=(22/RS/25005512_0) already exists.\'}', 'Failed to process Adnak/purchases/20260130_095548_IMG_20260101_130418763.jpg: {\'message\': \'duplicate key value violates unique constraint "inventory_items_row_id_key"\', \'code\': \'23505\', \'hint\': None, \'details\': \'Key (row_id)=(22/RS/25005508_0) already exists.\'}'], 'duplicates': []}
2026-01-30 09:57:22 2026-01-30 09:57:22,254 - routes.inventory - WARNING - Processing errors: ['Failed to process Adnak/purchases/20260130_095548_IMG_20260101_130433647.jpg: {\'message\': \'duplicate key value violates unique constraint "inventory_items_row_id_key"\', \'code\': \'23505\', \'hint\': None, \'details\': \'Key (row_id)=(22/RS/25005512_0) already exists.\'}', 'Failed to process Adnak/purchases/20260130_095548_IMG_20260101_130418763.jpg: {\'message\': \'duplicate key value violates unique constraint "inventory_items_row_id_key"\', \'code\': \'23505\', \'hint\': None, \'details\': \'Key (row_id)=(22/RS/25005508_0) already exists.\'}']
2026-01-30 09:57:22 2026-01-30 09:57:22,254 - routes.inventory - INFO - === INVENTORY PROCESSING COMPLETED ===
2026-01-30 09:57:32 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:57:32 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:57:42 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:57:42 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:57:52 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:57:52 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:58:05 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:58:05 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:58:12 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:58:12 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:58:22 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:58:22 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:58:32 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:58:32 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:58:42 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:58:42 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:58:52 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:58:52 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:59:02 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:59:02 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:59:12 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:59:12 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:59:12 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/stock/levels?status_filter=all&priority_filter=all&_t=1769767146211
2026-01-30 09:59:12 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/stock/calculate
2026-01-30 09:59:12 POST 200 https://digientry-backend-112233610459.asia-south1.run.app/api/stock/calculate
2026-01-30 09:59:12 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/stock/levels?status_filter=all&priority_filter=all&_t=1769767146211
2026-01-30 09:59:12 2026-01-30 09:59:12,503 - routes.stock_routes - INFO - Starting stock recalculation for Adnak
2026-01-30 09:59:12 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/stock/summary
2026-01-30 09:59:12 2026-01-30 09:59:12,565 - routes.stock_routes - INFO - Found 135 vendor invoice items
2026-01-30 09:59:12 2026-01-30 09:59:12,565 - routes.stock_routes - INFO - Fetching ALL sales records for Adnak with pagination...
2026-01-30 09:59:12 2026-01-30 09:59:12,573 - routes.stock_routes - INFO - Retrieved 95 stock levels for Adnak
2026-01-30 09:59:12 2026-01-30 09:59:12,621 - routes.stock_routes - INFO - Found 211 sales invoice items
2026-01-30 09:59:12 2026-01-30 09:59:12,655 - routes.stock_routes - INFO - Found 6 inventory mappings
2026-01-30 09:59:12 2026-01-30 09:59:12,691 - routes.stock_routes - INFO - Found 95 existing stock levels to preserve
2026-01-30 09:59:12 2026-01-30 09:59:12,691 - routes.stock_routes - INFO - ? Step 1: Initializing stock_by_part with 6 mappings
2026-01-30 09:59:12 2026-01-30 09:59:12,691 - routes.stock_routes - INFO - ? Step 2: Filling IN transactions from 135 vendor invoices
2026-01-30 09:59:12 2026-01-30 09:59:12,698 - routes.stock_routes - INFO - ? Step 3: Building part-to-customer mapping for 114 parts
2026-01-30 09:59:12 2026-01-30 09:59:12,699 - routes.stock_routes - INFO - ? Step 4: Processing 211 sales transactions
2026-01-30 09:59:12 2026-01-30 09:59:12,748 - database - INFO - Batch upserting 114 records to 'stock_levels' in 1 batches
2026-01-30 09:59:12 2026-01-30 09:59:12,828 - database - INFO - ? Batch upsert complete: 114 records processed
2026-01-30 09:59:12 2026-01-30 09:59:12,829 - routes.stock_routes - INFO - ? Recalculated 114 stock levels for Adnak
2026-01-30 09:59:22 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:59:22 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:59:32 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:59:32 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:59:42 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 09:59:42 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:59:52 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 09:59:52 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 10:00:02 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 10:00:02 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 10:00:11 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/verified/unique-customer-items?search=h
2026-01-30 10:00:11 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/verified/unique-customer-items?search=h
2026-01-30 10:00:11 2026-01-30 10:00:11,800 - routes.verified - INFO - Found 42 unique customer items for Adnak
2026-01-30 10:00:11 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/verified/unique-customer-items?search=ho
2026-01-30 10:00:11 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/verified/unique-customer-items?search=ho
2026-01-30 10:00:12 2026-01-30 10:00:12,032 - routes.verified - INFO - Found 8 unique customer items for Adnak
2026-01-30 10:00:12 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 10:00:12 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 10:00:12 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/verified/unique-customer-items?search=hol
2026-01-30 10:00:12 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/verified/unique-customer-items?search=hol
2026-01-30 10:00:12 2026-01-30 10:00:12,294 - routes.verified - INFO - Found 1 unique customer items for Adnak
2026-01-30 10:00:12 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/verified/unique-customer-items?search=hold
2026-01-30 10:00:12 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/verified/unique-customer-items?search=hold
2026-01-30 10:00:12 2026-01-30 10:00:12,937 - routes.verified - INFO - Found 1 unique customer items for Adnak
2026-01-30 10:00:13 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/verified/unique-customer-items?search=holder
2026-01-30 10:00:13 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/verified/unique-customer-items?search=holder
2026-01-30 10:00:13 2026-01-30 10:00:13,317 - routes.verified - INFO - Found 1 unique customer items for Adnak
2026-01-30 10:00:17 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/vendor-mapping/entries/bulk-save
2026-01-30 10:00:17 POST 200 https://digientry-backend-112233610459.asia-south1.run.app/api/vendor-mapping/entries/bulk-save
2026-01-30 10:00:17 2026-01-30 10:00:17,517 - routes.vendor_mapping_routes - INFO - Bulk saved 1 entries, 0 errors
2026-01-30 10:00:22 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 10:00:22 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 10:00:23 POST 200 https://digientry-backend-112233610459.asia-south1.run.app/api/vendor-mapping/entries/bulk-save
2026-01-30 10:00:23 2026-01-30 10:00:23,349 - routes.vendor_mapping_routes - INFO - Bulk saved 1 entries, 0 errors
2026-01-30 10:00:25 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/vendor-mapping/entries/by-part/36118M82P00
2026-01-30 10:00:25 DELETE 200 https://digientry-backend-112233610459.asia-south1.run.app/api/vendor-mapping/entries/by-part/36118M82P00
2026-01-30 10:00:25 2026-01-30 10:00:25,437 - routes.vendor_mapping_routes - INFO - Deleted vendor mapping and cleared stock_levels for part 36118M82P00
2026-01-30 10:00:27 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/auth/me
2026-01-30 10:00:27 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/stock/levels?status_filter=all&priority_filter=all&_t=1769767221703
2026-01-30 10:00:27 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 10:00:27 POST 200 https://digientry-backend-112233610459.asia-south1.run.app/api/stock/calculate
2026-01-30 10:00:27 2026-01-30 10:00:27,804 - routes.stock_routes - INFO - Starting stock recalculation for Adnak
2026-01-30 10:00:27 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/stock/summary
2026-01-30 10:00:27 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 10:00:27 2026-01-30 10:00:27,884 - routes.stock_routes - INFO - Found 135 vendor invoice items
2026-01-30 10:00:27 2026-01-30 10:00:27,884 - routes.stock_routes - INFO - Fetching ALL sales records for Adnak with pagination...
2026-01-30 10:00:27 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/stock/levels?status_filter=all&priority_filter=all&_t=1769767221703
2026-01-30 10:00:27 2026-01-30 10:00:27,934 - routes.stock_routes - INFO - Found 211 sales invoice items
2026-01-30 10:00:27 2026-01-30 10:00:27,948 - routes.stock_routes - INFO - Retrieved 114 stock levels for Adnak
2026-01-30 10:00:27 2026-01-30 10:00:27,975 - routes.stock_routes - INFO - Found 6 inventory mappings
2026-01-30 10:00:28 2026-01-30 10:00:28,018 - routes.stock_routes - INFO - Found 114 existing stock levels to preserve
2026-01-30 10:00:28 2026-01-30 10:00:28,019 - routes.stock_routes - INFO - ? Step 1: Initializing stock_by_part with 6 mappings
2026-01-30 10:00:28 2026-01-30 10:00:28,019 - routes.stock_routes - INFO - ? Step 2: Filling IN transactions from 135 vendor invoices
2026-01-30 10:00:28 2026-01-30 10:00:28,027 - routes.stock_routes - INFO - ? Step 3: Building part-to-customer mapping for 114 parts
2026-01-30 10:00:28 2026-01-30 10:00:28,028 - routes.stock_routes - INFO - ? Step 4: Processing 211 sales transactions
2026-01-30 10:00:28 2026-01-30 10:00:28,085 - database - INFO - Batch upserting 114 records to 'stock_levels' in 1 batches
2026-01-30 10:00:28 2026-01-30 10:00:28,159 - database - INFO - ? Batch upsert complete: 114 records processed
2026-01-30 10:00:28 2026-01-30 10:00:28,160 - routes.stock_routes - INFO - ? Recalculated 114 stock levels for Adnak
2026-01-30 10:00:33 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/verified/unique-customer-items?search=b
2026-01-30 10:00:33 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/verified/unique-customer-items?search=b
2026-01-30 10:00:33 2026-01-30 10:00:33,791 - routes.verified - INFO - Found 43 unique customer items for Adnak
2026-01-30 10:00:33 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/verified/unique-customer-items?search=bu
2026-01-30 10:00:34 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/verified/unique-customer-items?search=bu
2026-01-30 10:00:34 2026-01-30 10:00:34,051 - routes.verified - INFO - Found 12 unique customer items for Adnak
2026-01-30 10:00:34 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/verified/unique-customer-items?search=bul
2026-01-30 10:00:34 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/verified/unique-customer-items?search=bul
2026-01-30 10:00:34 2026-01-30 10:00:34,334 - routes.verified - INFO - Found 7 unique customer items for Adnak
2026-01-30 10:00:37 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 10:00:37 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 10:00:38 POST 200 https://digientry-backend-112233610459.asia-south1.run.app/api/vendor-mapping/entries/bulk-save
2026-01-30 10:00:38 2026-01-30 10:00:38,635 - routes.vendor_mapping_routes - INFO - Bulk saved 1 entries, 0 errors
2026-01-30 10:00:44 POST 200 https://digientry-backend-112233610459.asia-south1.run.app/api/vendor-mapping/entries/bulk-save
2026-01-30 10:00:44 2026-01-30 10:00:44,675 - routes.vendor_mapping_routes - INFO - Bulk saved 1 entries, 0 errors
2026-01-30 10:00:48 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 10:00:48 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 10:00:58 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 10:00:58 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 10:01:08 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 10:01:08 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 10:01:18 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 10:01:18 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 10:01:27 2026-01-30 10:01:27,843 - services.inventory_processor - INFO - ? Vendor invoice processed: 20260130_095548_IMG_20260101_130433647.jpg (Model: Flash, Accuracy: 100.0%)
2026-01-30 10:01:28 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 10:01:28 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 10:01:28 2026-01-30 10:01:28,273 - services.inventory_processor - ERROR - Error saving to inventory_items: {'message': 'duplicate key value violates unique constraint "inventory_items_row_id_key"', 'code': '23505', 'hint': None, 'details': 'Key (row_id)=(22/RS/25005512_0) already exists.'}
2026-01-30 10:01:28 2026-01-30 10:01:28,273 - services.inventory_processor - ERROR - Failed to process Adnak/purchases/20260130_095548_IMG_20260101_130433647.jpg: {'message': 'duplicate key value violates unique constraint "inventory_items_row_id_key"', 'code': '23505', 'hint': None, 'details': 'Key (row_id)=(22/RS/25005512_0) already exists.'}
2026-01-30 10:01:28 2026-01-30 10:01:28,273 - routes.inventory - INFO - Progress: 2/2 (Failed: 2) - Adnak/purchases/20260130_095548_IMG_20260101_130433647.jpg
2026-01-30 10:01:28 2026-01-30 10:01:28,274 - services.inventory_processor - INFO - Inventory batch processing complete: 0 succeeded, 2 failed, 0 duplicates
2026-01-30 10:01:28 2026-01-30 10:01:28,274 - routes.inventory - INFO - Processing completed. Results: {'processed': 0, 'failed': 2, 'errors': ['Failed to process Adnak/purchases/20260130_095548_IMG_20260101_130418763.jpg: {\'message\': \'duplicate key value violates unique constraint "inventory_items_row_id_key"\', \'code\': \'23505\', \'hint\': None, \'details\': \'Key (row_id)=(22/RS/25005508_0) already exists.\'}', 'Failed to process Adnak/purchases/20260130_095548_IMG_20260101_130433647.jpg: {\'message\': \'duplicate key value violates unique constraint "inventory_items_row_id_key"\', \'code\': \'23505\', \'hint\': None, \'details\': \'Key (row_id)=(22/RS/25005512_0) already exists.\'}'], 'duplicates': []}
2026-01-30 10:01:28 2026-01-30 10:01:28,274 - routes.inventory - WARNING - Processing errors: ['Failed to process Adnak/purchases/20260130_095548_IMG_20260101_130418763.jpg: {\'message\': \'duplicate key value violates unique constraint "inventory_items_row_id_key"\', \'code\': \'23505\', \'hint\': None, \'details\': \'Key (row_id)=(22/RS/25005508_0) already exists.\'}', 'Failed to process Adnak/purchases/20260130_095548_IMG_20260101_130433647.jpg: {\'message\': \'duplicate key value violates unique constraint "inventory_items_row_id_key"\', \'code\': \'23505\', \'hint\': None, \'details\': \'Key (row_id)=(22/RS/25005512_0) already exists.\'}']
2026-01-30 10:01:28 2026-01-30 10:01:28,274 - routes.inventory - INFO - === INVENTORY PROCESSING COMPLETED ===
2026-01-30 10:01:38 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 10:01:38 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 10:02:05 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 10:02:05 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 10:03:05 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
2026-01-30 10:03:05 OPTIONS 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 10:03:05 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/amounts
2026-01-30 10:03:05 GET 200 https://digientry-backend-112233610459.asia-south1.run.app/api/review/dates
